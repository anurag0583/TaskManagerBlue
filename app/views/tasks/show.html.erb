<div class="page-wrapper" style="min-height: 354px;">
  <div class="content container-fluid">
    <div class="row">
      <div class="col-xs-8">
        <h4 class="page-title"><%= @task.name.capitalize %></h4>
      </div>
      <div class="col-sm-4 text-right m-b-30">
        <a href="#" class="btn btn-primary rounded" data-toggle="modal" data-target="#edit_project"><i class="fa fa-plus"></i> Edit Task</a>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-9">
        <div class="panel">
          <div class="panel-body">
            <div class="project-title">
              <h5 class="panel-title"><%= @task.name.capitalize %></h5>
              <small class="block text-ellipsis m-b-15"><span class="text-xs"></span> <span class="text-muted"></span><span class="text-xs"></span> <span class="text-muted"></span></small>
            </div>
            <p><%= @task.details.capitalize %></p>
          </div>
        </div>
        <div class="panel">
          <div class="panel-body">
            <h5 class="panel-title m-b-20">Uploaded image files</h5>
            <div class="row">
              <div class="col-md-3 col-sm-6">
                <div class="thumbnail">
                  <div class="thumb">
                    <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                  </div>
                  <div class="caption text-center">
                     demo.png
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-body">
            <h5 class="panel-title m-b-20">Comments</h5>
            <ul class="files-list">
              <% @comments.each do |comment| %>
                <li> 
                  <div class="files-cont">
                    <div class="file-type">
                      <!-- <span class="files-icon"><i class="fa fa-file-pdf-o"></i></span> -->
                      <%= image_tag comment.user.photo.url(:small),:width => "30",:class=>"avatar" %> 
                    </div>
                    <div class="files-info">
                      <span class="file-name text-ellipsis">
                        <a href="#"><%= comment.body.capitalize %></a>
                      </span>
                      <span class="file-author"><a href="#"><%= full_name(comment.user) %></a></span>
                      <span class="file-date"><%= time_ago_in_words(comment.created_at) %></span>
                      <div class="file-size"><%= comment.created_at.strftime("%d %b, %Y") %></div>
                    </div>
                    <ul class="files-action">
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle btn btn-default btn-xs" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></a>
                        <ul class="dropdown-menu">
                          <li><a href="<%= edit_task_comment_path(@task,comment) %>">Edit</a></li>
                          <li><a href="<%= task_comment_path(@task,comment) %>">Delete</a></li> 
                        </ul>
                      </li>
                    </ul>
                  </div>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-3">
        <div class="panel">
          <div class="panel-body">
            <h6 class="panel-title m-b-15">Task details</h6>
            <table class="table table-striped table-border">
              <tbody>
                <tr>
                  <td>Project:</td>
                  <td class="text-right"><%= Project.find(@task.project_id).name %></td>
                </tr>
                <tr>
                  <td>Start Time:</td>
                  <td class="text-right"><%= @task.start_date.strftime("%d %b, %Y") %></td>
                </tr>
                <tr>
                  <td>End Time:</td>
                  <td class="text-right"><%= @task.end_date.strftime("%d %b, %Y") %></td>
                </tr>
                <tr>
                  <td>Priority:</td>
                  <td class="text-right">
                    <div class="btn-group">
                      <% if @task.priority == "High" %>
                        <a href="#" class="label label-danger dropdown-toggle" data-toggle="dropdown">
                          <%= @task.priority %> <span class="caret"></span>
                        </a>
                      <% elsif @task.priority == "Medium" %>
                        <a href="#" class="label label-info dropdown-toggle" data-toggle="dropdown">
                          <%= @task.priority %> <span class="caret"></span>
                        </a>
                      <% elsif @task.priority == "Low" %>
                        <a href="#" class="label label-success dropdown-toggle" data-toggle="dropdown">
                          <%= @task.priority %> <span class="caret"></span>
                        </a>
                      <% end %>
                      <%= form_with(model: @task, local: true) do |form| %>
                        <%= form.select(:priority, Task::PRIORITY ,class: "dropdown-menu dropdown-menu-right") %>   
                      <% end %>
                      <!-- <ul class="dropdown-menu dropdown-menu-right">
                        <li><a href="#"><i class="fa fa-dot-circle-o text-danger"></i> Highest priority</a></li>
                        <li><a href="#"><i class="fa fa-dot-circle-o text-info"></i> High priority</a></li>
                        <li><a href="#"><i class="fa fa-dot-circle-o text-primary"></i> Normal priority</a></li>
                        <li><a href="#"><i class="fa fa-dot-circle-o text-success"></i> Low priority</a></li>
                      </ul> -->
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>Created by:</td>
                  <td class="text-right"><a href="<%= user_path(User.find(@task.created_by_id))%>"><%= full_name(User.find(@task.created_by_id)) %></a></td>
                </tr>
                <tr>
                  <td>Status:</td>
                  <td class="text-right">
                  <% if @task.status = "todo" %>
                    <span class="label label-danger-border"><%= @task.status.capitalize %></span>
                  <% elsif @task.status = "inprogress" %>
                    <span class="label label-danger-border"><%= @task.status.capitalize %></span>
                  <% elsif @task.status = "done" %>
                    <span class="label label-danger-border"><%= @task.status.capitalize %></span>
                  <% end %>
                  <%= form_with(model: @task, local: true) do |form| %>
                    <%= form.select(:status, Task::STATUS) %>              
                  <% end %>
                  </td>
                </tr>
              </tbody>
            </table>
            <p class="m-b-5">Progress <span class="text-success pull-right">40%</span></p>
            <div class="progress progress-xs m-b-0">
              <div class="progress-bar progress-bar-success" role="progressbar" data-toggle="tooltip" title="" style="width: 40%" data-original-title="40%"></div>
            </div>
          </div>
        </div>
        <div class="panel project-user">
          <div class="panel-body">
            <h6 class="panel-title m-b-20">Assigned Leader <a class="pull-right btn btn-primary btn-xs" data-toggle="modal" data-target="#assign_leader"><i class="fa fa-plus"></i> Add</a></h6>
            <ul class="list-box">
              <li>
                <a href="profile.html">
                  <div class="list-item">
                    <div class="list-left">
                      <span class="avatar">W</span>
                    </div>
                    <div class="list-body">
                      <span class="message-author">Wilmer Deluna</span>
                      <div class="clearfix"></div>
                      <span class="message-content">Team Leader</span>
                    </div>
                  </div>
                </a>
              </li>
              <li>
                <a href="profile.html">
                  <div class="list-item">
                    <div class="list-left">
                      <span class="avatar">L</span>
                    </div>
                    <div class="list-body">
                      <span class="message-author">Lesley Grauer</span>
                      <div class="clearfix"></div>
                      <span class="message-content">Team Leader</span>
                    </div>
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="panel project-user">
          <div class="panel-heading">
            <h6 class="panel-title">Assigned users <a class="pull-right btn btn-primary btn-xs" data-toggle="modal" data-target="#assign_user"><i class="fa fa-plus"></i> Add</a></h6>
          </div>
          <div class="panel-body">
            <ul class="list-box">
              <li>
                <a href="profile.html">
                  <div class="list-item">
                    <div class="list-left">
                      <span class="avatar">J</span>
                    </div>
                    <div class="list-body">
                      <span class="message-author">John Doe</span>
                      <div class="clearfix"></div>
                      <span class="message-content">Web Designer</span>
                    </div>
                  </div>
                </a>
              </li>
              <li>
                <a href="profile.html">
                  <div class="list-item">
                    <div class="list-left">
                      <span class="avatar">V</span>
                    </div>
                    <div class="list-body">
                      <span class="message-author">Richard Miles</span>
                      <div class="clearfix"></div>
                      <span class="message-content">Web Developer</span>
                    </div>
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function () {
  $("[name='task[status]']").change(function(){
    var status = $("[name='task[status]'] option:selected").val();
    console.log(status);
    var task_id = $(this).parents('form').attr('action').split('/')[2]
    console.log(task_id);  console.log(status);
     $.ajax({
        url:'/tasks/'+ task_id  + '/update_status',
        type:'POST',
        dataType:'json',
        beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
        data:{
            status: status
        },
        success:function(data){
            console.log(data);
        },
        error:function(data){
            console.log(data);
        }
    });
  });
  $("[name='task[priority]']").change(function(){
    var priority = $("[name='task[priority]'] option:selected").val();
    console.log(priority);
    var task_id = $(this).parents('form').attr('action').split('/')[2]
    console.log(task_id);  console.log(priority);
     $.ajax({
        url:'/tasks/'+ task_id  + '/update_status',
        type:'POST',
        dataType:'json',
        beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
        data:{
            priority: priority
        },
        success:function(data){
            console.log(data);
        },
        error:function(data){
            console.log(data);
        } 
    });
  });
});

</script> 

<div class="page-wrapper" style="min-height: 354px;">
  <div class="content container-fluid">
    <div class="row">
      <div class="col-xs-8">
        <h4 class="page-title">Harvey Clinic</h4>
      </div>
      <div class="col-sm-4 text-right m-b-30">
        <a href="#" class="btn btn-primary rounded" data-toggle="modal" data-target="#edit_project"><i class="fa fa-plus"></i> Edit Project</a>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-9">
        <div class="panel">
          <div class="panel-body">
            <div class="project-title">
              <h5 class="panel-title">Harvey Clinic</h5>
              <small class="block text-ellipsis m-b-15"><span class="text-xs">2</span> <span class="text-muted">open tasks, </span><span class="text-xs">5</span> <span class="text-muted">tasks completed</span></small>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec vel elit neque. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vestibulum sollicitudin libero vitae est consectetur, a molestie tortor consectetur. Aenean tincidunt interdum ipsum, id pellentesque diam suscipit ut. Vivamus massa mi, fermentum eget neque eget, imperdiet tristique lectus. Proin at purus ut sem pellentesque tempor sit amet ut lectus. Sed orci augue, placerat et pretium ac, hendrerit in felis. Integer scelerisque libero non metus commodo, et hendrerit diam aliquet. Proin tincidunt porttitor ligula, a tincidunt orci pellentesque nec. Ut ultricies maximus nulla id consequat. Fusce eu consequat mi, eu euismod ligula. Aliquam porttitor neque id massa porttitor, a pretium velit vehicula. Morbi volutpat tincidunt urna, vel ullamcorper ligula fermentum at. </p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec vel elit neque. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vestibulum sollicitudin libero vitae est consectetur, a molestie tortor consectetur. Aenean tincidunt interdum ipsum, id pellentesque diam suscipit ut. Vivamus massa mi, fermentum eget neque eget, imperdiet tristique lectus. Proin at purus ut sem pellentesque tempor sit amet ut lectus. Sed orci augue, placerat et pretium ac, hendrerit in felis. Integer scelerisque libero non metus commodo, et hendrerit diam aliquet. Proin tincidunt porttitor ligula, a tincidunt orci pellentesque nec. Ut ultricies maximus nulla id consequat. Fusce eu consequat mi, eu euismod ligula. Aliquam porttitor neque id massa porttitor, a pretium velit vehicula. Morbi volutpat tincidunt urna, vel ullamcorper ligula fermentum at. </p>
          </div>
        </div>
        <div class="panel">
          <div class="panel-body">
                      <h5 class="panel-title m-b-20">Uploaded image files</h5>
            <div class="row">
              <div class="col-md-3 col-sm-6">
                <div class="thumbnail">
                  <div class="thumb">
                    <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                  </div>
                  <div class="caption text-center">
                     demo.png
                  </div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="thumbnail">
                  <div class="thumb">
                    <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                  </div>
                  <div class="caption text-center">
                     demo.png
                  </div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="thumbnail">
                  <div class="thumb">
                    <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                  </div>
                  <div class="caption text-center">
                     demo.png
                  </div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="thumbnail">
                  <div class="thumb">
                    <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                  </div>
                  <div class="caption text-center">
                     demo.png
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-body">
            <h5 class="panel-title m-b-20">Uploaded files</h5>
            <ul class="files-list">
              <li>
                <div class="files-cont">
                  <div class="file-type">
                    <span class="files-icon"><i class="fa fa-file-pdf-o"></i></span>
                  </div>
                  <div class="files-info">
                    <span class="file-name text-ellipsis"><a href="#">AHA Selfcare Mobile Application Test-Cases.xls</a></span>
                    <span class="file-author"><a href="#">John Doe</a></span> <span class="file-date">May 31st at 6:53 PM</span>
                    <div class="file-size">Size: 14.8Mb</div>
                  </div>
                  <ul class="files-action">
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle btn btn-default btn-xs" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></a>
                      <ul class="dropdown-menu">
                        <li><a href="javascript:void(0)">Download</a></li>
                        <li><a href="#" data-toggle="modal" data-target="#share_files">Share</a></li>
                        <li><a href="javascript:void(0)">Delete</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </li>
              <li>
                <div class="files-cont">
                  <div class="file-type">
                    <span class="files-icon"><i class="fa fa-file-pdf-o"></i></span>
                  </div>
                  <div class="files-info">
                    <span class="file-name text-ellipsis"><a href="#">AHA Selfcare Mobile Application Test-Cases.xls</a></span>
                    <span class="file-author"><a href="#">Richard Miles</a></span> <span class="file-date">May 31st at 6:53 PM</span>
                    <div class="file-size">Size: 14.8Mb</div>
                  </div>
                  <ul class="files-action">
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle btn btn-default btn-xs" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></a>
                      <ul class="dropdown-menu">
                        <li><a href="javascript:void(0)">Download</a></li>
                        <li><a href="#" data-toggle="modal" data-target="#share_files">Share</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <div class="project-task">
          <div class="tabbable">
            <ul class="nav nav-tabs nav-tabs-top nav-justified m-b-0">
              <li class="active"><a href="#all_tasks" data-toggle="tab" aria-expanded="true">All Tasks</a></li>
              <li><a href="#pending_tasks" data-toggle="tab" aria-expanded="false">Pending Tasks</a></li>
              <li><a href="#completed_tasks" data-toggle="tab" aria-expanded="false">Completed Tasks</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="all_tasks">
                <div class="task-wrapper">
                  <div class="task-list-container">
                    <div class="task-list-body">
                      <ul id="task-list">
                        <li class="task">
                          <div class="task-container">
                            <span class="task-action-btn task-check">
                              <span class="action-circle large complete-btn" title="Mark Complete">
                                <i class="material-icons">check</i>
                              </span>
                            </span>
                            <span class="task-label" contenteditable="true">Patient appointment booking</span>
                            <span class="task-action-btn task-btn-right">
                              <span class="action-circle large" title="Assign">
                                <i class="material-icons">person_add</i>
                              </span>
                              <span class="action-circle large delete-btn" title="Delete Task">
                                <i class="material-icons">delete</i>
                              </span>
                            </span>
                          </div>
                        </li>
                        <li class="task">
                          <div class="task-container">
                            <span class="task-action-btn task-check">
                              <span class="action-circle large complete-btn" title="Mark Complete">
                                <i class="material-icons">check</i>
                              </span>
                            </span>
                            <span class="task-label" contenteditable="true">Appointment booking with payment gateway</span>
                            <span class="task-action-btn task-btn-right">
                              <span class="action-circle large" title="Assign">
                                <i class="material-icons">person_add</i>
                              </span>
                              <span class="action-circle large delete-btn" title="Delete Task">
                                <i class="material-icons">delete</i>
                              </span>
                            </span>
                          </div>
                        </li>
                        <li class="completed task">
                          <div class="task-container">
                            <span class="task-action-btn task-check">
                              <span class="action-circle large complete-btn" title="Mark Complete">
                                <i class="material-icons">check</i>
                              </span>
                            </span>
                            <span class="task-label">Doctor available module</span>
                            <span class="task-action-btn task-btn-right">
                              <span class="action-circle large" title="Assign">
                                <i class="material-icons">person_add</i>
                              </span>
                              <span class="action-circle large delete-btn" title="Delete Task">
                                <i class="material-icons">delete</i>
                              </span>
                            </span>
                          </div>
                        </li>
                        <li class="task">
                          <div class="task-container">
                            <span class="task-action-btn task-check">
                              <span class="action-circle large complete-btn" title="Mark Complete">
                                <i class="material-icons">check</i>
                              </span>
                            </span>
                            <span class="task-label" contenteditable="true">Patient and Doctor video conferencing</span>
                            <span class="task-action-btn task-btn-right">
                              <span class="action-circle large" title="Assign">
                                <i class="material-icons">person_add</i>
                              </span>
                              <span class="action-circle large delete-btn" title="Delete Task">
                                <i class="material-icons">delete</i>
                              </span>
                            </span>
                          </div>
                        </li>
                        <li class="task">
                          <div class="task-container">
                            <span class="task-action-btn task-check">
                              <span class="action-circle large complete-btn" title="Mark Complete">
                                <i class="material-icons">check</i>
                              </span>
                            </span>
                            <span class="task-label" contenteditable="true">Private chat module</span>
                            <span class="task-action-btn task-btn-right">
                              <span class="action-circle large" title="Assign">
                                <i class="material-icons">person_add</i>
                              </span>
                              <span class="action-circle large delete-btn" title="Delete Task">
                                <i class="material-icons">delete</i>
                              </span>
                            </span>
                          </div>
                        </li>
                        <li class="task">
                          <div class="task-container">
                            <span class="task-action-btn task-check">
                              <span class="action-circle large complete-btn" title="Mark Complete">
                                <i class="material-icons">check</i>
                              </span>
                            </span>
                            <span class="task-label" contenteditable="true">Patient Profile add</span>
                            <span class="task-action-btn task-btn-right">
                              <span class="action-circle large" title="Assign">
                                <i class="material-icons">person_add</i>
                              </span>
                              <span class="action-circle large delete-btn" title="Delete Task">
                                <i class="material-icons">delete</i>
                              </span>
                            </span>
                          </div>
                        </li>
                      </ul>
                    </div>
                    <div class="task-list-footer">
                      <div class="new-task-wrapper">
                        <textarea id="new-task" placeholder="Enter new task here. . ."></textarea>
                        <span class="error-message hidden">You need to enter a task first</span>
                        <span class="add-new-task-btn btn" id="add-task">Add Task</span>
                        <span class="cancel-btn btn" id="close-task-panel">Close</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tab-pane" id="pending_tasks"></div>
              <div class="tab-pane" id="completed_tasks"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-3">
        <div class="panel">
          <div class="panel-body">
            <h6 class="panel-title m-b-15">Project details</h6>
            <table class="table table-striped table-border">
              <tbody>
                <tr>
                  <td>Cost:</td>
                  <td class="text-right">$1200</td>
                </tr>
                <tr>
                  <td>Total Hours:</td>
                  <td class="text-right">100 Hours</td>
                </tr>
                <tr>
                  <td>Created:</td>
                  <td class="text-right">25 Feb, 2017</td>
                </tr>
                <tr>
                  <td>Deadline:</td>
                  <td class="text-right">12 Nov, 2017</td>
                </tr>
                <tr>
                  <td>Priority:</td>
                  <td class="text-right">
                    <div class="btn-group">
                      <a href="#" class="label label-danger dropdown-toggle" data-toggle="dropdown">Highest <span class="caret"></span></a>
                      <ul class="dropdown-menu dropdown-menu-right">
                        <li><a href="#"><i class="fa fa-dot-circle-o text-danger"></i> Highest priority</a></li>
                        <li><a href="#"><i class="fa fa-dot-circle-o text-info"></i> High priority</a></li>
                        <li><a href="#"><i class="fa fa-dot-circle-o text-primary"></i> Normal priority</a></li>
                        <li><a href="#"><i class="fa fa-dot-circle-o text-success"></i> Low priority</a></li>
                      </ul>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>Created by:</td>
                  <td class="text-right"><a href="profile.html">Barry Cuda</a></td>
                </tr>
                <tr>
                  <td>Status:</td>
                  <td class="text-right">Working</td>
                </tr>
              </tbody>
            </table>
            <p class="m-b-5">Progress <span class="text-success pull-right">40%</span></p>
            <div class="progress progress-xs m-b-0">
              <div class="progress-bar progress-bar-success" role="progressbar" data-toggle="tooltip" title="" style="width: 40%" data-original-title="40%"></div>
            </div>
          </div>
        </div>
        <div class="panel project-user">
          <div class="panel-body">
            <h6 class="panel-title m-b-20">Assigned Leader <a class="pull-right btn btn-primary btn-xs" data-toggle="modal" data-target="#assign_leader"><i class="fa fa-plus"></i> Add</a></h6>
            <ul class="list-box">
              <li>
                <a href="profile.html">
                  <div class="list-item">
                    <div class="list-left">
                      <span class="avatar">W</span>
                    </div>
                    <div class="list-body">
                      <span class="message-author">Wilmer Deluna</span>
                      <div class="clearfix"></div>
                      <span class="message-content">Team Leader</span>
                    </div>
                  </div>
                </a>
              </li>
              <li>
                <a href="profile.html">
                  <div class="list-item">
                    <div class="list-left">
                      <span class="avatar">L</span>
                    </div>
                    <div class="list-body">
                      <span class="message-author">Lesley Grauer</span>
                      <div class="clearfix"></div>
                      <span class="message-content">Team Leader</span>
                    </div>
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="panel project-user">
          <div class="panel-heading">
            <h6 class="panel-title">Assigned users <a class="pull-right btn btn-primary btn-xs" data-toggle="modal" data-target="#assign_user"><i class="fa fa-plus"></i> Add</a></h6>
          </div>
          <div class="panel-body">
            <ul class="list-box">
              <li>
                <a href="profile.html">
                  <div class="list-item">
                    <div class="list-left">
                      <span class="avatar">J</span>
                    </div>
                    <div class="list-body">
                      <span class="message-author">John Doe</span>
                      <div class="clearfix"></div>
                      <span class="message-content">Web Designer</span>
                    </div>
                  </div>
                </a>
              </li>
              <li>
                <a href="profile.html">
                  <div class="list-item">
                    <div class="list-left">
                      <span class="avatar">V</span>
                    </div>
                    <div class="list-body">
                      <span class="message-author">Richard Miles</span>
                      <div class="clearfix"></div>
                      <span class="message-content">Web Developer</span>
                    </div>
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
          </div>
  <div class="notification-box">
    <div class="msg-sidebar notifications msg-noti">
      <div class="topnav-dropdown-header">
        <span>Messages</span>
      </div>
      <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 230px;"><div class="drop-scroll msg-list-scroll" style="overflow: hidden; width: auto; height: 230px;">
        <ul class="list-box">
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">R</span>
                </div>
                <div class="list-body">
                  <span class="message-author">Richard Miles </span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item new-message">
                <div class="list-left">
                  <span class="avatar">J</span>
                </div>
                <div class="list-body">
                  <span class="message-author">John Doe</span>
                  <span class="message-time">1 Aug</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">T</span>
                </div>
                <div class="list-body">
                  <span class="message-author"> Tarah Shropshire </span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">M</span>
                </div>
                <div class="list-body">
                  <span class="message-author">Mike Litorus</span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">C</span>
                </div>
                <div class="list-body">
                  <span class="message-author"> Catherine Manseau </span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">D</span>
                </div>
                <div class="list-body">
                  <span class="message-author"> Domenic Houston </span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">B</span>
                </div>
                <div class="list-body">
                  <span class="message-author"> Buster Wigton </span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">R</span>
                </div>
                <div class="list-body">
                  <span class="message-author"> Rolland Webber </span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">C</span>
                </div>
                <div class="list-body">
                  <span class="message-author"> Claire Mapes </span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">M</span>
                </div>
                <div class="list-body">
                  <span class="message-author">Melita Faucher</span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">J</span>
                </div>
                <div class="list-body">
                  <span class="message-author">Jeffery Lalor</span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">L</span>
                </div>
                <div class="list-body">
                  <span class="message-author">Loren Gatlin</span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <a href="chat.html">
              <div class="list-item">
                <div class="list-left">
                  <span class="avatar">T</span>
                </div>
                <div class="list-body">
                  <span class="message-author">Tarah Shropshire</span>
                  <span class="message-time">12:28 AM</span>
                  <div class="clearfix"></div>
                  <span class="message-content">Lorem ipsum dolor sit amet, consectetur adipiscing</span>
                </div>
              </div>
            </a>
          </li>
        </ul>
      </div><div class="slimScrollBar" style="background: rgb(135, 135, 135); width: 4px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 0px; z-index: 99; right: 1px; height: 751px;"></div><div class="slimScrollRail" style="width: 4px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 1px;"></div></div>
      <div class="topnav-dropdown-footer">
        <a href="chat.html">See all messages</a>
      </div>
    </div>
  </div>
</div>










<% team_members_arr = @task.project.users.to_a %>

<div class="col-lg-12" style="margin: 20px 0 0 -20px;">
  <div class="panel panel-default">
    <div class="panel-heading" style="background-color:white !important; border-bottom:none !important;">
      <div class="col-lg-8">
        <span style="padding: 5px;">
          <% if @task.status == "done" %>
            <i class="fa fa-bookmark" style="font-size: 15px;color: green;"></i>
          <% elsif @task.status == "in progress" %>
            <i class="fa fa-bookmark" style="font-size: 15px;color: blue;"></i>
          <% else @task.status == "to do" %>
            <i class="fa fa-bookmark" style="font-size: 15px;color: grey;"></i>
          <% end %>
        </span>
        <%= @task.project.name.capitalize %>
      </div>
      <div class="col-lg-4">
        <span class="pull-right" style="padding: 5px;">
          <%= link_to edit_task_path(@task)  do %>
            <i class="fa fa-pencil" aria-hidden="true"></i>
          <% end %>
        </span>
      </div>
    </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-lg-8">
            <p> 
              <span> 
                <h4><%= @task.name.capitalize %></h4>
              </span>
            </p>
            <p>
              <span style="padding: 11px 7px 3px 5px;background-color: #80808057;">
                <%= link_to @task.document.url do %>
                  <i  class="fa fa-paperclip" aria-hidden="true" style="font-size: 25px;color: black; "></i>
                <% end %>
              </span>
            </p>
            <p>
              <span><%= @task.details.capitalize %></span>
            </p>
            <p>
              <% if @task.document.present? %>
                <strong>Attachments</strong></br>
                <%#= @task.document.content_type.inspect %>
                <% if @task.document.content_type != "image/png" %>
                  <%#= link_to 'Download PDF',@task.document.url %>
                  <iframe src="<%= @task.document.url %>" width="100%" height="200px;"></iframe>
                <% end %>
                <% if @task.document.content_type == "image/png" %>
                  <%= image_tag @task.document.url,:width => "150",:class=>"w3-round" %> 
                <% end %>
              <% end %>
            </p>
            <p>
              <strong>Activity</strong>
            </p>
            <p>
              <% @comments.each do |comment| %>
                <div class="panel-heading" style="padding: 0px !important;">
                  <div class="row">
                    <div class="col-lg-8">
                      <span class="chat-img pull-left" style="padding: 10px;">
                        <%= image_tag comment.user.photo.url(:small),:width => "30",:class=>"img-circle" %> 
                      </span>
                      <div class="chat-body clearfix">
                        <div class="header">
                          <strong class="primary-font"><%= full_name(comment.user) %></strong>
                          <% if can? :update, @task %>
                            <small class="text-muted">
                              <%= link_to task_comment_path(@task,comment), method: :delete, data: { confirm: 'Are you sure?' }  do %>
                                <i class="pull-right fa fa-trash" style="font-size: 15px;color: gray;"></i>
                              <% end%>
                            </small>
                          <% end %>
                          <% if can? :update, @task %>
                            <small class="text-muted">
                              <%= link_to edit_task_comment_path(@task,comment) do %>
                                <i class="pull-right fa fa-edit" style="font-size: 15px;color: gray;"></i>
                              <% end%>
                            </small>
                          <% end %>
                          <small class="pull-right text-muted">
                            <i class="fa fa-clock-o fa-fw"></i><%= time_ago_in_words(comment.created_at) %>
                          </small>
                        </div>
                        <p>
                          <%= comment.body.capitalize %>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              <% end%>
              <%= form_for ([@task,@comment]), :html => { :class => "form-horizontal comment" } do |form| %>
                <% if @comment.errors.any? %>
                  <div id="error_explanation">
                    <ul>
                    <% @comment.errors.full_messages.each do |message| %>
                      <li><%= message.capitalize %></li>
                    <% end %>
                    </ul>
                  </div>
                <% end %>
                <div class="field">
                  <%= form.text_field :body, id: :comment_body %>
                  <%= form.submit %>
                </div>          
              <% end %>
            </p>
          </div>
          
          <div class="col-lg-4">
            <p>
              <strong class="status-#{@task.id}" >Status</strong> <br>
              <%= form_with(model: @task, local: true) do |form| %>
                <%= form.select(:status, Task::STATUS) %>              
              <% end %>
            </p>  
            <p>
            <strong>Assignee :</strong> <br>
            <%= image_tag User.find(@task.assign_task_user_id).photo.url(:small),:width => "30",:class=>"img-circle" %> 
            <%= full_name(User.find(@task.assign_task_user_id)) %> (<%= User.find(@task.created_by_id).email %>) <br>
            <%#= link_to full_name(User.find(@task.assign_task_user_id)), user_path %>
              <% if can? :update, @task %>
                <%= link_to 'Assign task', "#" ,:class=>"btn btn-xs btn-primary",:'data-toggle'=>"modal" ,:'data-target'=>"#myModal-1" %>
                  <% end %>
            </p>
            <p>
            <strong>Reporter :</strong> <br>
              <%= full_name(User.find(@task.created_by_id)) %> (<%= User.find(@task.created_by_id).email %>) <br>
            </p>
            <p>
            <strong>Created By :</strong> <br>
              <%= full_name(User.find(@task.created_by_id)) %> (<%= User.find(@task.created_by_id).email %>) <br>
            </p>
            <p>
            <!-- <strong>Priority :</strong> <br> -->
            <!-- <%#= @task.priority %><br> -->
            <p>
              <strong class="priority-#{@task.id}" >Priority</strong> <br>
              <%= form_with(model: @task, local: true) do |form| %>
                <%= form.select(:priority, Task::PRIORITY ) %>           
              <% end %>
            </p>    
            </p>
            <p>
            <strong>Start Time :</strong> <br>
              <%= @task.start_date.strftime("%d %b, %Y") %><br>
            </p>
            <p>
            <strong>End Time :</strong> <br>
               <%= @task.end_date.strftime("%d %b, %Y") %><br>
            </p>
          </div>
        </div>

      </div>
      <div class="modal fade" id="myModal-1" role="dialog">
        <div class="modal-dialog modal-md">
          <div class="modal-content">
            <div class="modal-body">
              <%= form_tag assign_task_task_path(@task), method: :get, id: "contact_form", class: "contact_form" do %>
                <% if team_members_arr.empty? %>
                  <%= "There is no member in team, please add by click here:" %>
                  <%#= link_to "Add team members", [:new, @team, :team_membership] %>
                <% else %>
                  <% team_members_arr.each do |team_member| %>
                    <%= radio_button_tag :user_id , team_member.id %>
                    <%= full_name(team_member) + " ( " + team_member.email + " )" %>
                    <br/>
                  <% end %>
                <% end %>
                <div class="modal-footer">
                  <button class="myModal-close btn btn-default" data-dismiss="modal" id="myModal-1" type="button">Close</button>
                  <% if !team_members_arr.empty? %>
                    <%= submit_tag("Send", class: "btn btn-default" ,id: "submitForm") %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- <p id="notice"><%#= notice %></p>

<p>
  <strong>Name:</strong>
  <%#= @task.name %>
</p>
<p>
  <strong>Details:</strong>
  <%#= @task.details %>
</p>
<p>
  <strong>Status:</strong>
  <%#= @task.status %>
</p>
<p>
  <strong>Priority:</strong>
  <%#= @task.priority %>
</p>

<p>
  <strong>Documente:</strong>
  <iframe src="<%#= @task.document.url %>"></iframe> 
</p>
<%#= link_to 'Edit', edit_task_path(@task) %> |
<%#= link_to 'Back', tasks_path %>
 -->

<script type="text/javascript">
$(document).ready(function () {
  $("[name='task[status]']").change(function(){
    var status = $("[name='task[status]'] option:selected").val();
    console.log(status);
    var task_id = $(this).parents('form').attr('action').split('/')[2]
    console.log(task_id);  console.log(status);
     $.ajax({
        url:'/tasks/'+ task_id  + '/update_status',
        type:'POST',
        dataType:'json',
        beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
        data:{
            status: status
        },
        success:function(data){
            console.log(data);
        },
        error:function(data){
            console.log(data);
        }
    });
  });
  $("[name='task[priority]']").change(function(){
    var priority = $("[name='task[priority]'] option:selected").val();
    console.log(priority);
    var task_id = $(this).parents('form').attr('action').split('/')[2]
    console.log(task_id);  console.log(priority);
     $.ajax({
        url:'/tasks/'+ task_id  + '/update_status',
        type:'POST',
        dataType:'json',
        beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
        data:{
            priority: priority
        },
        success:function(data){
            console.log(data);
        },
        error:function(data){
            console.log(data);
        } 
    });
  });
});

</script> 